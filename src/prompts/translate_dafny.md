Translate Python loop-heavy code into Dafny.

Requirements:
1. Add loop invariants and decreases clauses.
2. Encode canonical obligations as ensures/assertions.
3. Return Dafny code only.

